<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Isolate your homelab using VLANs, Proxmox, and OPNsense | Andrew's Admin Archives</title>
<meta name=keywords content="Homelab,VLAN,Networking">
<meta name=description content="Create a secure and efficient isolated homelab on a non-VLAN aware home network using VLAN-aware switches and Proxmox bridges. When paired with Wireguard, you can securely access this network from anywhere. No longer takes down your entire houses network when you mess something up!">
<meta name=author content="Andrew">
<link rel=canonical href=https://adminarchives.com/posts/isolate-homelab-with-vlan/>
<link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://adminarchives.com/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://adminarchives.com/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://adminarchives.com/favicon-32x32.png>
<link rel=apple-touch-icon href=https://adminarchives.com/apple-touch-icon.png>
<link rel=mask-icon href=https://adminarchives.com/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript><meta property="og:title" content="Isolate your homelab using VLANs, Proxmox, and OPNsense">
<meta property="og:description" content="Create a secure and efficient isolated homelab on a non-VLAN aware home network using VLAN-aware switches and Proxmox bridges. When paired with Wireguard, you can securely access this network from anywhere. No longer takes down your entire houses network when you mess something up!">
<meta property="og:type" content="article">
<meta property="og:url" content="https://adminarchives.com/posts/isolate-homelab-with-vlan/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2023-09-19T12:20:06-04:00">
<meta property="article:modified_time" content="2023-09-19T12:20:06-04:00"><meta property="og:site_name" content="Andrew's Admin Archives">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Isolate your homelab using VLANs, Proxmox, and OPNsense">
<meta name=twitter:description content="Create a secure and efficient isolated homelab on a non-VLAN aware home network using VLAN-aware switches and Proxmox bridges. When paired with Wireguard, you can securely access this network from anywhere. No longer takes down your entire houses network when you mess something up!">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://adminarchives.com/posts/"},{"@type":"ListItem","position":2,"name":"Isolate your homelab using VLANs, Proxmox, and OPNsense","item":"https://adminarchives.com/posts/isolate-homelab-with-vlan/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Isolate your homelab using VLANs, Proxmox, and OPNsense","name":"Isolate your homelab using VLANs, Proxmox, and OPNsense","description":"Create a secure and efficient isolated homelab on a non-VLAN aware home network using VLAN-aware switches and Proxmox bridges. When paired with Wireguard, you can securely access this network from anywhere. No longer takes down your entire houses network when you mess something up!","keywords":["Homelab","VLAN","Networking"],"articleBody":" NOTE: I soon plan to put more time into these articles including additional details and specific configs, as well as explaining how I set everything up. If you have any questions or would like to contribute to an article, please contact me at andrew@andrew-houser.com.\n Current network map Internet | Home Router (192.168.1.1/24) |------------------- Other devices on Home Network | | (VLAN 10 Uplink - Untagged) Switch | Proxmox Host ------ OPNsense VM (Uplink on VLAN 10, Internal on VLAN 5) | | | | (VLAN 5 \u0026 10) | (VLAN 5 Internal) | | | VMs \u0026 Proxmox Host | VMs on Internal Network | (10.0.x.x/16) | (10.0.x.x/16) | | OPNsense IP: 10.0.0.1 | VLAN 5 acts as the internal network isolated from your home, while VLAN 10 is used as an ‘uplink’ for OPNsense and any hosts and is untagged for the router.\nOPNsense has a network bridge to both VLAN 5 and 10, routing between the VLAN 5 ‘LAN’ network and VLAN 10 ‘WAN’.\nFurther isolations (3 or more vlans) Internet | Home Router (192.168.1.1/24) |------------------- Other devices on Home Network | | (VLAN 10 Uplink - Untagged) Switch | Proxmox Host ------ OPNsense VM (Uplink on VLAN 10, Internal on VLAN 15) | | | (VLAN 5) | (VLAN 15 Internal) VMs on Management VMs on Internal Network Network (10.0.0.x/24) (10.15.0.x/24) OPNsense allows you to add optional network adapters as well, giving you the ability to further isolate the setup with further VLANs. In this example, VLAN 15 will be isolated from your management network. Isolation like this should be used for publicly exposed services.\nUsing OPNsense firewall rules, you could block VLAN 15 from connecting to devices with IP ranges 10.0.x.x and 192.168.1.x, giving it only access to the internet and needed internal services.\n","wordCount":"298","inLanguage":"en","datePublished":"2023-09-19T12:20:06-04:00","dateModified":"2023-09-19T12:20:06-04:00","author":{"@type":"Person","name":"Andrew"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://adminarchives.com/posts/isolate-homelab-with-vlan/"},"publisher":{"@type":"Organization","name":"Andrew's Admin Archives","logo":{"@type":"ImageObject","url":"https://adminarchives.com/favicon.ico"}}}</script>
</head>
<body class=dark id=top>
<script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://adminarchives.com/ accesskey=h title="Andrew's Admin Archives (Alt + H)">Andrew's Admin Archives</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=https://adminarchives.com/posts/ title=posts>
<span>posts</span>
</a>
</li>
<li>
<a href=https://adminarchives.com/tags/ title=tags>
<span>tags</span>
</a>
</li>
<li>
<a href=https://adminarchives.com/search/ title="search (Alt + /)" accesskey=/>
<span>search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://adminarchives.com/>Home</a>&nbsp;»&nbsp;<a href=https://adminarchives.com/posts/>Posts</a></div>
<h1 class=post-title>
Isolate your homelab using VLANs, Proxmox, and OPNsense
</h1>
<div class=post-description>
Create a secure and efficient isolated homelab on a non-VLAN aware home network using VLAN-aware switches and Proxmox bridges. When paired with Wireguard, you can securely access this network from anywhere. No longer takes down your entire houses network when you mess something up!
</div>
<div class=post-meta><span title="2023-09-19 12:20:06 -0400 EDT">September 19, 2023</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;298 words&nbsp;·&nbsp;Andrew
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#current-network-map>Current network map</a></li>
<li><a href=#further-isolations-3-or-more-vlans>Further isolations (3 or more vlans)</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</details>
</div>
<div class=post-content><blockquote>
<p><strong>NOTE:</strong> I soon plan to put more time into these articles including additional details and specific configs, as well as explaining how I set everything up. If you have any questions or would like to contribute to an article, please contact me at <em>andrew@andrew-houser.com</em>.</p>
</blockquote>
<h3 id=current-network-map>Current network map<a hidden class=anchor aria-hidden=true href=#current-network-map>#</a></h3>
<pre tabindex=0><code class=language-less data-lang=less>Internet
    |
Home Router (192.168.1.1/24)
    |------------------- Other devices on Home Network
    |
    | (VLAN 10 Uplink - Untagged)
Switch 
    |
Proxmox Host ------ OPNsense VM (Uplink on VLAN 10, Internal on VLAN 5)
|        |                  |
|  (VLAN 5 &amp; 10)            | (VLAN 5 Internal)
|                           |
|  VMs &amp; Proxmox Host       | VMs on Internal Network
|  (10.0.x.x/16)            | (10.0.x.x/16)
|                           | OPNsense IP: 10.0.0.1
|

</code></pre><p>VLAN 5 acts as the internal network isolated from your home, while VLAN 10 is used as an &lsquo;uplink&rsquo; for OPNsense and any hosts and is untagged for the router.</p>
<p>OPNsense has a network bridge to both VLAN 5 and 10, routing between the VLAN 5 &lsquo;LAN&rsquo; network and VLAN 10 &lsquo;WAN&rsquo;.</p>
<h3 id=further-isolations-3-or-more-vlans>Further isolations (3 or more vlans)<a hidden class=anchor aria-hidden=true href=#further-isolations-3-or-more-vlans>#</a></h3>
<pre tabindex=0><code class=language-less data-lang=less>Internet
    |
Home Router (192.168.1.1/24)
    |------------------- Other devices on Home Network
    |
    | (VLAN 10 Uplink - Untagged)
Switch 
    |
Proxmox Host ------ OPNsense VM (Uplink on VLAN 10, Internal on VLAN 15)
    |                       |
    | (VLAN 5)              | (VLAN 15 Internal)
    VMs on Management       VMs on Internal Network
    Network (10.0.0.x/24)   (10.15.0.x/24)
</code></pre><p>OPNsense allows you to add optional network adapters as well, giving you the ability to further isolate the setup with further VLANs.
In this example, VLAN 15 will be isolated from your management network. Isolation like this should be used for publicly exposed services.</p>
<p>Using OPNsense firewall rules, you could block VLAN 15 from connecting to devices with IP ranges 10.0.x.x and 192.168.1.x, giving it only access to the internet and needed internal services.</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://adminarchives.com/tags/homelab/>Homelab</a></li>
<li><a href=https://adminarchives.com/tags/vlan/>VLAN</a></li>
<li><a href=https://adminarchives.com/tags/networking/>Networking</a></li>
</ul>
<nav class=paginav>
<a class=next href=https://adminarchives.com/posts/vps-wireguard-gateway/>
<span class=title>Next »</span>
<br>
<span>WireGuard VPS as Reverse Proxy and Gateway to Home Network</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2023 <a href=https://adminarchives.com/>Andrew's Admin Archives</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>